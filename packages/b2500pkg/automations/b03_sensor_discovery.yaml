automation:
  alias: B2500PKG_B03_Sensor_Discovery
  description: ""
  triggers:
    - topic: B2500PKG/B2500_03/CD01
      trigger: mqtt
  conditions: []
  actions:
    - variables:
        payload: "{{ trigger.payload }}"
    - if:
        - condition: template
          value_template: "{{ 'l0=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/l0_bit0/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Entladen",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ ('{:0=8b}'.format(value.split('l0=')[1].split(',')[0] | int(0) )|batch(1)|map('join')|join(' ')).split(' ')[7] }}",
                "default_entity_id": "sensor.b2500_03_l0_bit0",
                "unique_id": "b2500_03_l0_bit0",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'l0=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/l0_bit1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Laden",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ ('{:0=8b}'.format(value.split('l0=')[1].split(',')[0] | int(0) )|batch(1)|map('join')|join(' ')).split(' ')[6] }}",
                "default_entity_id": "sensor.b2500_03_l0_bit1",
                "unique_id": "b2500_03_l0_bit1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'l0=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/l0_bit2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 DOD erreicht",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ ('{:0=8b}'.format(value.split('l0=')[1].split(',')[0] | int(0) )|batch(1)|map('join')|join(' ')).split(' ')[5] }}",
                "default_entity_id": "sensor.b2500_03_l0_bit2",
                "unique_id": "b2500_03_l0_bit2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'l0=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/l0_bit3/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Unterspannung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ ('{:0=8b}'.format(value.split('l0=')[1].split(',')[0] | int(0) )|batch(1)|map('join')|join(' ')).split(' ')[4] }}",
                "default_entity_id": "sensor.b2500_03_l0_bit3",
                "unique_id": "b2500_03_l0_bit3",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'l1=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/l1_bit0/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03E2 Entladen",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ ('{:0=8b}'.format(value.split('l1=')[1].split(',')[0] | int(0) )|batch(1)|map('join')|join(' ')).split(' ')[7] }}",
                "default_entity_id": "sensor.b2500_03_l1_bit0",
                "unique_id": "b2500_03_l1_bit0",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'l1=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/l1_bit1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03E2 Laden",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ ('{:0=8b}'.format(value.split('l1=')[1].split(',')[0] | int(0) )|batch(1)|map('join')|join(' ')).split(' ')[6] }}",
                "default_entity_id": "sensor.b2500_03_l1_bit1",
                "unique_id": "b2500_03_l1_bit1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'l1=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/l1_bit2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03E2 DOD erreicht",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ ('{:0=8b}'.format(value.split('l1=')[1].split(',')[0] | int(0) )|batch(1)|map('join')|join(' ')).split(' ')[5] }}",
                "default_entity_id": "sensor.b2500_03_l1_bit2",
                "unique_id": "b2500_03_l1_bit2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'l1=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/l1_bit3/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03E2 Unterspannung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ ('{:0=8b}'.format(value.split('l1=')[1].split(',')[0] | int(0) )|batch(1)|map('join')|join(' ')).split(' ')[4] }}",
                "default_entity_id": "sensor.b2500_03_l1_bit3",
                "unique_id": "b2500_03_l1_bit3",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'l1=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/l1_bit4/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03E1 Entladen",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ ('{:0=8b}'.format(value.split('l1=')[1].split(',')[0] | int(0) )|batch(1)|map('join')|join(' ')).split(' ')[3] }}",
                "default_entity_id": "sensor.b2500_03_l1_bit4",
                "unique_id": "b2500_03_l1_bit4",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'l1=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/l1_bit5/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03E1 Laden",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ ('{:0=8b}'.format(value.split('l1=')[1].split(',')[0] | int(0) )|batch(1)|map('join')|join(' ')).split(' ')[2] }}",
                "default_entity_id": "sensor.b2500_03_l1_bit5",
                "unique_id": "b2500_03_l1_bit5",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'l1=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/l1_bit6/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03E1 DOD erreicht",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ ('{:0=8b}'.format(value.split('l1=')[1].split(',')[0] | int(0) )|batch(1)|map('join')|join(' ')).split(' ')[1] }}",
                "default_entity_id": "sensor.b2500_03_l1_bit6",
                "unique_id": "b2500_03_l1_bit6",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'l1=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/l1_bit7/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03E1 Unterspannung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ ('{:0=8b}'.format(value.split('l1=')[1].split(',')[0] | int(0) )|batch(1)|map('join')|join(' ')).split(' ')[0] }}",
                "default_entity_id": "sensor.b2500_03_l1_bit7",
                "unique_id": "b2500_03_l1_bit7",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'b1=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/b1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 E1 verbunden",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ value.split('b1=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_b1",
                "unique_id": "b2500_03_b1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'b2=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/b2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 E2 verbunden",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ value.split('b2=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_b2",
                "unique_id": "b2500_03_b2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'p1=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/p1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Solar1 Input Status",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('p1=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_p1",
                "unique_id": "b2500_03_p1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'p2=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/p2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Solar2 Input Status",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('p2=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_p2",
                "unique_id": "b2500_03_p2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'w1=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/w1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 PV1 Leistung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "state_class": "measurement",
                "device_class": "power",
                "unit_of_measurement": "W",
                "value_template": "{{ value.split('w1=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_w1",
                "unique_id": "b2500_03_w1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'w2=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/w2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 PV2 Leistung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "state_class": "measurement",
                "device_class": "power",
                "unit_of_measurement": "W",
                "value_template": "{{ value.split('w2=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_w2",
                "unique_id": "b2500_03_w2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'pe=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/pe/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Batterie SOC",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "state_class": "measurement",
                "device_class": "battery",
                "unit_of_measurement": "%",
                "value_template": "{{ value.split('pe=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_pe",
                "unique_id": "b2500_03_pe",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'vv=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/vv/config
            retain: true
            payload: |
              {% raw %} {              
                "name": "B03 Geräteversion",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('vv=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_vv",
                "unique_id": "b2500_03_vv",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'sv=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/sv/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Gerätesubversion",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('sv=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_sv",
                "unique_id": "b2500_03_sv",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'cs=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/cs/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Ladeeinstellung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('cs=')[1].split(',')[0].replace('0','Laden und Entladen gleichzeitig').replace('1','Laden vor dem Entladen') }}",
                "default_entity_id": "sensor.b2500_03_cs",
                "unique_id": "b2500_03_cs",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'cd=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/cd/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Entladeeinstellung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{% set parts = value.split('cd=') %}{% if parts | length > 1 %}{% set cd = parts[1].split(',')[0] %}{% if cd == '0' %}Ausgang PV1 und PV2 off{% elif cd == '1' %}Ausgang PV1 on, PV2 off{% elif cd == '2' %}Ausgang PV1 off, PV2 on{% elif cd == '3' %}Ausgang PV1 und PV2 on{% else %}unbekannt{% endif %}{% else %}unbekannt{% endif %}",
                "default_entity_id": "sensor.b2500_03_cd",
                "unique_id": "b2500_03_cd",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'am=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/am/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 AM",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('am=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_am",
                "unique_id": "b2500_03_am",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'o1=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/o1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Output Status 1",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('o1=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_o1",
                "unique_id": "b2500_03_o1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'o2=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/o2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Output Status 2",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('o2=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_o2",
                "unique_id": "b2500_03_o2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'do=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/do/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 DOD Entnehmbare Kapazität in %",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('do=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_do",
                "unique_id": "b2500_03_do",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'lv=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/lv/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Entladeschwelle",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('lv=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_lv",
                "unique_id": "b2500_03_lv",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'cj=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/cj/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 CJ Scene",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('cj=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_cj",
                "unique_id": "b2500_03_cj",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'kn=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/kn/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Gesamtkapazität",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "device_class": "energy_storage",
                "state_class": "measurement",
                "unit_of_measurement": "Wh",
                "value_template": "{{ value.split('kn=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_kn",
                "unique_id": "b2500_03_kn",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'g1=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/g1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Output1 Leistung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "state_class": "measurement",
                "device_class": "power",
                "unit_of_measurement": "W",
                "value_template": "{{ value.split('g1=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_g1",
                "unique_id": "b2500_03_g1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'g2=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/g2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Output2 Leistung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "state_class": "measurement",
                "device_class": "power",
                "unit_of_measurement": "W",
                "value_template": "{{ value.split('g2=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_g2",
                "unique_id": "b2500_03_g2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'tl=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/tl/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Temperatur low",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('tl=')[1].split(',')[0] }}",
                "device_class": "temperature",
                "unit_of_measurement": "°C",
                "default_entity_id": "sensor.b2500_03_tl",
                "unique_id": "b2500_03_tl",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'th=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/th/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Temperatur high",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('th=')[1].split(',')[0] }}",
                "device_class": "temperature",
                "unit_of_measurement": "°C",
                "default_entity_id": "sensor.b2500_03_th",
                "unique_id": "b2500_03_th",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'tc=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/tc/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Temperaturalarm (Laden)",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('tc=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_tc",
                "unique_id": "b2500_03_tc",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'tf=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/tf/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Temperaturalarm (Entladen)",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('tf=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_tf",
                "unique_id": "b2500_03_tf",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'fc=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/fc/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Chip Version",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('fc=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_fc",
                "unique_id": "b2500_03_fc",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'id=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/id/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Geräte ID",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('id=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_id",
                "unique_id": "b2500_03_id",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'a0=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/a0/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Ladezustand Hauptspeicher",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "unit_of_measurement": "%",
                "value_template": "{{ value.split('a0=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_a0",
                "unique_id": "b2500_03_a0",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'a1=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/a1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Ladezustand Erweiterung1",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "unit_of_measurement": "%",
                "value_template": "{{ value.split('a1=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_a1",
                "unique_id": "b2500_03_a1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'a2=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/a2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Ladezustand Erweiterung2",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "unit_of_measurement": "%",
                "value_template": "{{ value.split('a2=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_a2",
                "unique_id": "b2500_03_a2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'e1=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/e1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer1 Beginn",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('e1=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_e1",
                "unique_id": "b2500_03_e1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'f1=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/f1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer1 Ende",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('f1=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_f1",
                "unique_id": "b2500_03_f1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'h1=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/h1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer1 Ausgabeleistung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "unit_of_measurement": "W",
                "value_template": "{{ value.split('h1=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_h1",
                "unique_id": "b2500_03_h1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'e2=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/e2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer2 Beginn",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('e2=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_e2",
                "unique_id": "b2500_03_e2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'f2=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/f2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer2 Ende",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('f2=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_f2",
                "unique_id": "b2500_03_f2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'h2=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/h2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer2 Ausgabeleistung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "unit_of_measurement": "W",
                "value_template": "{{ value.split('h2=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_h2",
                "unique_id": "b2500_03_h2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'e3=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/e3/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer3 Beginn",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('e3=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_e3",
                "unique_id": "b2500_03_e3",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'f3=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/f3/config
            retain: true
            payload: |
              {% raw %} {
              "name": "B03 Timer3 Ende",
              "state_topic": "B2500PKG/B2500_03/CD01",
              "value_template": "{{ value.split('f3=')[1].split(',')[0] }}",
              "default_entity_id": "sensor.b2500_03_f3",
              "unique_id": "b2500_03_f3",
              "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'h3=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/h3/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer3 Ausgabeleistung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "unit_of_measurement": "W",
                "value_template": "{{ value.split('h3=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_h3",
                "unique_id": "b2500_03_h3",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'e4=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/e4/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer4 Beginn",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('e4=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_e4",
                "unique_id": "b2500_03_e4",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'f4=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/f4/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer4 Ende",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('f4=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_f4",
                "unique_id": "b2500_03_f4",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'h4=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/h4/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer4 Ausgabeleistung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "unit_of_measurement": "W",
                "value_template": "{{ value.split('h4=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_h4",
                "unique_id": "b2500_03_h4",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'e5=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/e5/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer5 Beginn",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('e5=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_e5",
                "unique_id": "b2500_03_e5",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'f5=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/f5/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer5 Ende",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('f5=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_f5",
                "unique_id": "b2500_03_f5",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'h5=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/h5/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer5 Ausgabeleistung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "unit_of_measurement": "W",
                "value_template": "{{ value.split('h5=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_h5",
                "unique_id": "b2500_03_h5",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'd1=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/d1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer1 aktiv",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ value.split('d1=')[1].split(',')[0] }}",
                "default_entity_id": "binary_sensor.b2500_03_d1",
                "unique_id": "b2500_03_d1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'd2=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/d2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer2 aktiv",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ value.split('d2=')[1].split(',')[0] }}",
                "default_entity_id": "binary_sensor.b2500_03_d2",
                "unique_id": "b2500_03_d2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'd3=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/d3/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer3 aktiv",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ value.split('d3=')[1].split(',')[0] }}",
                "default_entity_id": "binary_sensor.b2500_03_d3",
                "unique_id": "b2500_03_d3",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'd4=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/d4/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer4 aktiv",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ value.split('d4=')[1].split(',')[0] }}",
                "default_entity_id": "binary_sensor.b2500_03_d4",
                "unique_id": "b2500_03_d4",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'd5=' in payload }}"
      then:
        - data:
            topic: homeassistant/binary_sensor/b2500_03/d5/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Timer5 aktiv",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "payload_on": "1",
                "payload_off": "0",
                "value_template": "{{ value.split('d5=')[1].split(',')[0] }}",
                "default_entity_id": "binary_sensor.b2500_03_d5",
                "unique_id": "b2500_03_d5",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'bc=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/bc/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Tägliche Battterieladung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "state_class": "total_increasing",
                "device_class": "energy",
                "unit_of_measurement": "Wh",
                "value_template": "{{ value.split('bc=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_bc",
                "unique_id": "b2500_03_bc",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'bs=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/bs/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Tägliche Batterieentladung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "state_class": "total_increasing",
                "device_class": "energy",
                "unit_of_measurement": "Wh",
                "value_template": "{{ value.split('bs=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_bs",
                "unique_id": "b2500_03_bs",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'pt=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/pt/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Tägliche PV Erzeugung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "state_class": "total_increasing",
                "device_class": "energy",
                "unit_of_measurement": "Wh",
                "value_template": "{{ value.split('pt=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_pt",
                "unique_id": "b2500_03_pt",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'md=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/md/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Entlademodus Timer/Selbstanpassung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('md=')[1].split(',')[0].replace('0','Timer').replace('1','Selbstanpassung') }}",
                "default_entity_id": "sensor.b2500_03_md",
                "unique_id": "b2500_03_md",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'sg=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/sg/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 CT Sensor verbunden",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('sg=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_sg",
                "unique_id": "b2500_03_sg",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'sp=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/sp/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 SP",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('sp=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_sp",
                "unique_id": "b2500_03_sp",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'st=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/st/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 ST",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('st=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_st",
                "unique_id": "b2500_03_st",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'c0=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/c0/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 CTCH Kanal",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('c0=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_c0",
                "unique_id": "b2500_03_c0",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'c1=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/c1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Status CT",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('c1=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_c1",
                "unique_id": "b2500_03_c1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'it=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/it/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 IT Tägliche abgegebene Leistung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('it=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_it",
                "unique_id": "b2500_03_it",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'm0=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/m0/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Leistungsmessung Phase1",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('m0=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_m0",
                "unique_id": "b2500_03_m0",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'm1=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/m1/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Leistungsmessung Phase2",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('m1=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_m1",
                "unique_id": "b2500_03_m1",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'm2=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/m2/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Leistungsmessung Phase3",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('m2=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_m2",
                "unique_id": "b2500_03_m2",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'm3=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/m3/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 M3",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('m3=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_m3",
                "unique_id": "b2500_03_m3",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'lmo=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/lmo/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 LMO Nennausgangsleistung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "unit_of_measurement": "W",
                "value_template": "{{ value.split('lmo=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_lmo",
                "unique_id": "b2500_03_lmo",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'lmi=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/lmi/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 LMI Nennaufnahmeleistung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "unit_of_measurement": "W",
                "value_template": "{{ value.split('lmi=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_lmi",
                "unique_id": "b2500_03_lmi",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'lmf=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/lmf/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 LMF Gerätebeschränkung",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('lmf=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_lmf",
                "unique_id": "b2500_03_lmf",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish              
    - if:
        - condition: template
          value_template: "{{ 'uv=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/uv/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 UV",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('uv=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_uv",
                "unique_id": "b2500_03_uv",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'sm=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/sm/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 SM",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('sm=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_sm",
                "unique_id": "b2500_03_sm",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'bn=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/bn/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 BN",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('bn=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_bn",
                "unique_id": "b2500_03_bn",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'ct_t=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/ct_t/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Smartmeter Typ",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('ct_t=')[1].split(',')[0].replace('1','CT001').replace('3','CT002').replace('4','Shelly Pro 3EM').replace('6','CT003').replace('7','Shelly EM gen3').replace('8','Shelly Pro EM50').replace('9','Eco Tracker') }}",
                "default_entity_id": "sensor.b2500_03_ct_t",
                "unique_id": "b2500_03_ct_t",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'tc_dis=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/tc_dis/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Surplus Modus",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('tc_dis=')[1].split(',')[0].replace('0','Surplus Modus aktiv').replace('1','Surplus Modus deaktiviert') }}",
                "default_entity_id": "sensor.b2500_03_tc_dis",
                "unique_id": "b2500_03_tc_dis",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'ws=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/ws/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 Wifi Signal",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('ws=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_ws",
                "unique_id": "b2500_03_ws",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - if:
        - condition: template
          value_template: "{{ 'fktc=' in payload }}"
      then:
        - data:
            topic: homeassistant/sensor/b2500_03/fktc/config
            retain: true
            payload: |
              {% raw %} {
                "name": "B03 FKTC",
                "state_topic": "B2500PKG/B2500_03/CD01",
                "value_template": "{{ value.split('fktc=')[1].split(',')[0] }}",
                "default_entity_id": "sensor.b2500_03_fktc",
                "unique_id": "b2500_03_fktc",
                "entity_category": "diagnostic"
              } {% endraw %}
          action: mqtt.publish
    - action: automation.turn_off
      metadata: {}
      data:
        stop_actions: true
      target:
        entity_id: automation.b2500pkg_b03_sensor_discovery
